<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOME</title>
    <style>
        p{
            font-size: large;
            color: rgb(18, 105, 18);
        }
        h2{
            background-color: rgb(1, 66, 1);
            color: white;
            padding: 10px;
        }
        button{
            background-color: rgb(1, 66, 1);
            color: white;
            border-color: rgb(1, 66, 1) ;
            border-radius: 5px;
        }
        textarea{
            width: 330px;
            border : solid;
            border-color: rgb(1, 66, 1) ;
            border-radius: 5px;
        }
        a{
            font-size: 3px;
            color: rgb(18, 105, 18);
        }
        .article{
            width: 500px;
            padding: 10px;
            margin-top: 10px;
            border : solid;
            border-color: rgb(1, 66, 1) ;
            border-radius: 5px;
        }
        .post{
            width: 500px;
            padding: 10px;
            margin-top: 10px;
            border : solid;
            border-color: rgb(1, 66, 1) ;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div>
        <h2>POSTING</h2>
        <form method="get" action="/user/mypage">
            <button type="submit">My Page</button>
        </form>
    </div>
    <!--ê¸€ì“°ê¸°-->                                                
    <div class="post">  
        <form method="post" action="/article/upload" enctype="multipart/form-data">
            <div>
                <input type="radio" name="public" id="public" value="public" checked/>
                <label for="public">ê³µê°œ</label>
                <input type="radio" name="public" id="private" value="private"/>
                <label for="private">ë¹„ê³µê°œ</label>
            </div>
            <div>
                <textarea name="post"></textarea>
            </div>
            <div>
                <%for(let i =0; i<=5 ; i++ ){%>
                    <img src="" width="50" height="50"  id="image<%=i%>" style="display : none"/> 
                <%}%>
                <input type="file" name="attaches" accept="image/*" onchange="preview(event);" multiple/>
            </div>

            <button type="submit">POST</button>
        </form>
    </div>

    <!--ê²Œì‹œê¸€ ë³´ì—¬ì£¼ê¸°-->
    <%if(post){%>
        <%post.forEach(article=>{%>
            <%if(article.public === "public") {%>
                
                    <div class="article">
                        <div id="inline">
                            <img src=<%=article.writerImage??"/user/static/default.jpg"%> width="30" height="30" style="display: inline;">
                            <p style="display: inline;"><b><%=article.writerId%></b></p> <p style="display: inline; font-size: 2px;">@<%=article.writerName%></p>
                            <a href="/article/view" style="display: inline;">ìƒì„¸ë³´ê¸°</a>
                        </div>

                        <div>
                            <p><%=article.post%></p>
                        </div>

                        <%if(article.attaches){%>
                            <% article.attaches.forEach(elm =>{%>
                                <div >
                                    <img src=<%=elm%> width="200" height="200" >
                                </div>
                            <%})%>
                        <%}%>

                        <div>
                            <p style="display: inline;">ğŸ—¨ <%=article.comments.length%></p>
                            <p style="display: inline; font-size: 10px;"><%=new Date(article.createdAt).toLocaleString()%></p>
                        </div>
                    </div>
                
            <%}%>
        <%})%>
    <%}%>
    <script>
        //ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°ê¸°ëŠ¥. (ì ìš©ì€ ëˆŒëŸ¬ì•¼ ë¨.)
        function preview(evt){
            let file = Array.from(evt.target.files); //ì´ filesê°€ ìœ ì‚¬ë°°ì—´ì´ë¼ì„œ ë°°ì—´ë¡œ ë°”ê¿”ì£¼ëŠ” ê³¼ì •ì´ í•„ìš”í•¨
            if(file){ //
                file.forEach((elm,idx) => {
                    let reader = new FileReader();  //ë¸Œë¼ìš°ì €ì—ì„œë§Œ ëŒì•„ê°€ëŠ” í˜¸ìŠ¤íŠ¸ì´ë‹¤. browser host ê°ì²´
                    reader.readAsDataURL(elm); //ìš”ë˜í•˜ë©´ ì´ë²¤íŠ¸ë¡œ ë°œìƒí•œ íŒŒì¼ [0]ë²ˆì§¸êº¼ë¥¼ ë¸Œë¼ìš°ì €ê°€ ì½ì–´ì¤€ë‹¤.
                    reader.onload = function(rst){   //ì½ëŠ” ì‘ì—…ì´ ëë‚˜ë©´ function ì‹¤í–‰(ì½œë°±ê°œë…). 
                        document.querySelector(`#image${idx}`).src = rst.target.result;
                        document.querySelector(`#image${idx}`).style.display = "";
                    }
                });
            }
        }
    </script>

</body>
</html>